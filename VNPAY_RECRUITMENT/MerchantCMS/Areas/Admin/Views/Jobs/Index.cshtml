@using MvcPaging
@using PagedList.Mvc;
@using VNPRECRUITMENT.Models;
@{
    ViewBag.Title = "Index";


}
@functions{
    public string GenerateSlug(string Name)
    {
        string phrase = string.Format("{0}", Name);

        string str = RemoveUnicode(phrase).ToLower();
        // invalid chars
        str = System.Text.RegularExpressions.Regex.Replace(str, @"[^a-z0-9\s-]", "");
        // convert multiple spaces into one space
        str = System.Text.RegularExpressions.Regex.Replace(str, @"\s+", " ").Trim();
        // cut and trim
        str = str.Substring(0, str.Length <= 45 ? str.Length : 45).Trim();
        str = System.Text.RegularExpressions.Regex.Replace(str, @"\s", "-"); // hyphens
        return str;
    }

    public static string RemoveUnicode(string text)
    {
        string[] arr1 = new string[] { "á", "à", "ả", "ã", "ạ", "â", "ấ", "ầ", "ẩ", "ẫ", "ậ", "ă", "ắ", "ằ", "ẳ", "ẵ", "ặ",
    "đ",
    "é","è","ẻ","ẽ","ẹ","ê","ế","ề","ể","ễ","ệ",
    "í","ì","ỉ","ĩ","ị",
    "ó","ò","ỏ","õ","ọ","ô","ố","ồ","ổ","ỗ","ộ","ơ","ớ","ờ","ở","ỡ","ợ",
    "ú","ù","ủ","ũ","ụ","ư","ứ","ừ","ử","ữ","ự",
    "ý","ỳ","ỷ","ỹ","ỵ",};
        string[] arr2 = new string[] { "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a", "a",
    "d",
    "e","e","e","e","e","e","e","e","e","e","e",
    "i","i","i","i","i",
    "o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o","o",
    "u","u","u","u","u","u","u","u","u","u","u",
    "y","y","y","y","y",};
        for (int i = 0; i < arr1.Length; i++)
        {
            text = text.Replace(arr1[i], arr2[i]);
            text = text.Replace(arr1[i].ToUpper(), arr2[i].ToUpper());
        }
        return text;
    }
}
<style>
    .post-content img {
        max-width: 782px;
    }
</style>
<div class="container container-edit">
    <span></span>
    <div class="page-header">
        <h1>Quản lý công việc</h1>
    </div>
    <div class="row">
        <div class="col-md-12">
            <!-- PAGE CONTENT BEGINS -->
            <form class="form-horizontal" action="@Url.Action("Index" , "Jobs")" role="form">
                <div class="form-group">
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Tiêu đề công việc: </label>
                        <div class="col-sm-8">
                            <input type="text" name="keyword" value="" placeholder="Nhập từ khóa" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Phòng ban: </label>
                        <div class="col-sm-8">
                            @if (ViewBag.GroupList != null)
                            {
                                @Html.DropDownList("groupid", (IEnumerable<SelectListItem>)ViewBag.GroupList, "Tất cả", new { @class = "form-control search-select", data_style = "btn-primary", aria_expanded = "false" })
                            }

                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Trạng thái: </label>
                        <div class="col-sm-8">
                            <select class="form-control search-select " id="status" name="status">
                                <option value="0" selected>Tất cả</option>
                                <option value="1">Xuất bản</option>
                                <option value="2">Lưu nháp</option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="form-group">
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Tạo từ ngày: </label>
                        <div class="col-sm-8">
                            <input type="text" name="Created_From" id="datepicker" placeholder="@DateTime.Now.Date.ToString("dd/MM/yyyy")" class="form-control" />
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Đến ngày: </label>
                        <div class="col-sm-8">
                            <input type="text" name="Created_To" id="datepicker1"  placeholder="@DateTime.Now.Date.ToString("dd/MM/yyyy")" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Khu vực: </label>
                        <div class="col-sm-8">
                            <select class="form-control search-select " id="Location_Name" name="Location_Name">
                                <option value="0">Tất cả</option>
                                @foreach (var location in ViewBag.LocationList)
                                {
                                    <option value="@location.LOCATION_ID">@location.LOCATION_NAME</option>
                                }
                            </select>
                        </div>
                    </div>

                </div>
                <div class="form-group">
                    <div class="col-sm-4">
                        <label class="col-sm-4 control-label" for="form-field-1">Ngày hết hạn trước: </label>
                        <div class="col-sm-8">
                            <input type="text" name="Expired_To" id="datepicker2"  placeholder="@DateTime.Now.Date.ToString("dd-MM-yyyy")" class="form-control" />
                        </div>
                    </div>
                    </div>
                    <div class="clear"></div>
                    <div class="clearfix form-actions center">
                        <button class="btn btn-primary btn-sm" type="submit">Tìm kiếm</button>
                        <a href="@Url.Action("Create", "Jobs")" class="btn btn-dark-grey btn-sm">Thêm mới</a>
                    </div>
</form>
            <!-- /.col -->
        </div>
    </div>
     
    <div class="pager ">

        <ul class="pager" style="float:right"> @Html.Pager((int)ViewBag.pagesize, (int)ViewBag.pageno, (int)ViewBag.totalrow).Options(o => o.Action("Index").RouteValues(new { keyword = ViewBag.currentFilter, groupid = ViewBag.groupidFilter, status = ViewBag.statusFilter, Location_Name = ViewBag.locationFilter, Created_From = ViewBag.createdfromFilter, Created_To = ViewBag.createdtoFilter, Expired_To = ViewBag.expireddatetpFilter }))
            </ul>

    </div>
    <div class="row">
        <div class="col-xs-12">
            <!-- PAGE CONTENT BEGINS -->
            <table class="table table-striped table-hover" id="sample-table-2">
                <thead>
                    <tr class="center">
                        <th width="20" class="center">#</th>
                        <th class="center">Tiêu đề công việc</th>
                        <th class="center">Phòng ban</th>
                        <th class="center">Khu vực</th>
                        <th class="center">Số Lượng</th>
                        <th class="center">Số CV Apply</th>
                        <th class="center">Ngày tạo</th>
                        <th class="center">Ngày hết hạn</th>
                        <th class="center">Trạng thái</th>
                        <th class="center">Thêm</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in ViewBag.lstJob)
                    {
                        if (@item.JOB_ID != null)
                        {
                            <tr>
                                <td class="left">@item.ROWNUMBER</td>
                                <td class="left">@item.JOB_NAME</td>
                                <td class="left"> @item.GROUP_NAME</td>
                                @{
                                    VNPAY_RECRUITMENTEntities Dbcontext = new VNPAY_RECRUITMENTEntities();
                                    var location_name = Dbcontext.PROC_LOCATION_NAME_SELECTALL(item.JOB_ID);
                                    List<string> rs = new List<string>(); 
                                    foreach (var item_location in location_name)
                                    {
                                        rs.Add(item_location);
                                    }
                                    <td>@string.Join(",", rs) </td>
                                }
                                <td><span class="right">@item.NUMBER</span></td>
                                <td>@item.CV_APPLY_COUNT</td>

                                <td>@item.CREATED_DATE</td>
                                
                                @*@if (DateTime.ParseExact(item.EXPIRED_DATE, "dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture) <= DateTime.Now)
                                {
                                    <td><span style="color:red;">@item.EXPIRED_DATE</span></td>
                                }
                                else
                                {*@
                                    <td>@item.EXPIRED_DATE</td>
                                

                                @if (@item.JOB_STATUS == 1)
                                {
                                    <td><span class="label label-success">Xuất bản</span></td>
                                }
                                else if (@item.JOB_STATUS == 2)
                                {
                                    <td><span class="label label-danger">Lưu nháp</span></td>
                                }


                                <td class="left">
                                    <div class="visible-md visible-lg hidden-sm hidden-xs">
                                        <a href="@Url.Action("Edit")?id=@item.JOB_ID" class="btn btn-xs btn-success tooltips" data-placement="top" data-tooltip="Sửa" data-original-title="Sửa"><i class="fa fa-edit"></i></a>
                                        <a href="@Url.Action("Delete")?id=@item.JOB_ID" class="btn btn-xs btn-danger tooltips" data-tooltip="Xóa" data-placement="top" data-original-title="Xóa"><i class="fa fa-trash"></i></a>
                                        <a target="_blank" href="~/cong-viec/@GenerateSlug(item.JOB_NAME)/@item.JOB_ID" class="btn btn-xs btn-teal tooltips" data-tooltip="Chi tiết" data-placement="top" data-original-title="Chi tiết"><i class="fa fa-mail-forward"></i></a>
                                        <a href="@Url.Action("RefreshJob")?id=@item.JOB_ID" class="btn btn-xs btn-success tooltips" data-tooltip="Làm mới" data-placement="top" data-original-title=""><i class="fa fa-cog"></i></a>
                                    </div>
                                    @*<div class="visible-xs visible-sm hidden-md hidden-lg">
                                        <div class="btn-group">
                                            <a class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" href="#"> <i class="fa fa-cog"></i> <span class="caret"></span> </a>
                                            <ul role="menu" class="dropdown-menu pull-right">
                                                <li role="presentation"> <a role="menuitem" tabindex="-1" href="@Url.Action("Edit")?id=@item.JOB_ID"> <i class="fa fa-edit"></i> Sửa </a> </li>
                                                <li role="presentation"> <a role="menuitem" tabindex="-1" href="@Url.Action("Delete")?id=@item.JOB_ID"> <i class="fa fa-trash"></i> Xóa </a> </li>
                                                <li target="_blank" href="~/cong-viec/@GenerateSlug(item.JOB_NAME)/@item.JOB_ID" data-tooltip="Chi tiết" data-placement="top" data-original-title="Chi tiết"><i class="fa fa-mail-forward"></i></li>
                                                <li href="@Url.Action("RefreshJob")?id=@item.JOB_ID" class="btn btn-xs btn-youtube tooltips" data-tooltip="Làm mới" data-placement="top" data-original-title="Làm mới"><i class="fa fa-cog"></i></li>
                                               </ul>
                                        </div>
                                    </div>*@
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>

        </div>
        <!-- /.col -->
    </div>
    <div class="pager right">
            <ul class="pager" style="float:right">@Html.Pager((int)ViewBag.pagesize, (int)ViewBag.pageno, (int)ViewBag.totalrow).Options(o => o.Action("Index").RouteValues(new { keyword = ViewBag.currentFilter }))</ul>
    </div>

</div>

@section scripts{
    <script>
        function format_curency(a) {
            a.value = a.value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
        }
    </script>

<script>
    $(function () {
        $("#datepicker").datepicker();
    });
</script><script>
    $(function () {
        $("#datepicker1").datepicker();
    });
</script>
    <script>
        $(function () {
            $("#datepicker2").datepicker();
        });
</script>

}