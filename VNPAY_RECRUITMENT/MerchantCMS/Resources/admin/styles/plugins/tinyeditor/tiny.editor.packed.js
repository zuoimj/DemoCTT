var TINY = TINY || {}, T$ = T$ || function (e) { return document.getElementById(e) }, T$$$ = T$$$ || function () { return document.all ? 1 : 0 }; TINY.editor = function () { function e(e, n) { this.n = e, window[e] = this, this.t = T$(n.id), this.obj = n, this.xhtml = n.xhtml; var s = document.createElement("div"), o = document.createElement("div"), r = document.createElement("div"), l = n.controls.length, a = 0; for (this.i = document.createElement("iframe"), this.i.width = n.width || "auto", this.i.height = n.height || "250", this.ie = T$$$(), r.className = n.rowclass || "tinyeditor-header", s.className = n.cssclass || "tinyeditor", s.style.width = this.i.width + "px", s.appendChild(r), a; l > a; a++) { var c = n.controls[a]; if ("n" == c) r = document.createElement("div"), r.className = n.rowclass || "tinyeditor-header", s.appendChild(r); else if ("|" == c) { var h = document.createElement("div"); h.className = n.dividerclass || "tinyeditor-divider", r.appendChild(h) } else if ("font" == c) { var d = document.createElement("select"), p = n.fonts || ["Verdana", "Arial", "Georgia"], u = p.length, m = 0; for (d.className = "tinyeditor-font", d.onchange = new Function(this.n + '.ddaction(this, "fontname")'), d.options[0] = new Option("Font", ""), m; u > m; m++) { var g = p[m]; d.options[m + 1] = new Option(g, g) } r.appendChild(d) } else if ("size" == c) { var d = document.createElement("select"), y = n.sizes || [1, 2, 3, 4, 5, 6, 7], f = y.length, m = 0; for (d.className = "tinyeditor-size", d.onchange = new Function(this.n + '.ddaction(this, "fontsize")'), m; f > m; m++) { var v = y[m]; d.options[m] = new Option(v, v) } r.appendChild(d) } else if ("style" == c) { var d = document.createElement("select"), b = n.styles || [["Style", ""], ["Paragraph", "<p>"], ["Header 1", "<h1>"], ["Header 2", "<h2>"], ["Header 3", "<h3>"], ["Header 4", "<h4>"], ["Header 5", "<h5>"], ["Header 6", "<h6>"]], f = b.length, m = 0; for (d.className = "tinyeditor-style", d.onchange = new Function(this.n + '.ddaction(this, "formatblock")'), m; f > m; m++) { var w = b[m]; d.options[m] = new Option(w[0], w[1]) } r.appendChild(d) } else if (t[c]) { var $, E = document.createElement("div"), m = t[c], x = m[2], C = m[0] * i; E.className = n.controlclass, E.unselectable = "on", E.style.backgroundPosition = "0px " + C + "px", E.title = m[1], $ = "a" == x ? '.action("' + m[3] + '", 0, ' + (m[4] || 0) + ")" : '.insert("' + m[4] + '", "' + m[5] + '", "' + m[3] + '")', E.onmousedown = new Function(this.n + ("print" == c ? ".print()" : $)), E.onmouseover = new Function(this.n + ".hover(this, " + C + ", 1)"), E.onmouseout = new Function(this.n + ".hover(this, " + C + ", 0)"), r.appendChild(E), this.ie && (E.unselectable = "on") } } if (this.t.parentNode.insertBefore(s, this.t), this.t.style.width = this.i.width + "px", o.appendChild(this.t), o.appendChild(this.i), s.appendChild(o), this.t.style.display = "none", n.footer) { var T = document.createElement("div"); if (T.className = n.footerclass || "tinyeditor-footer", n.toggle) { var k = n.toggle, I = document.createElement("div"); I.className = k.cssclass || "toggle", I.innerHTML = n.toggletext || "source", I.onclick = new Function(this.n + ".toggle(0, this);return false"), T.appendChild(I) } if (n.resize) { var N = n.resize, S = document.createElement("div"); S.className = N.cssclass || "resize", S.onmousedown = new Function("event", this.n + ".resize(event);return false"), S.onselectstart = function () { return !1 }, T.appendChild(S) } s.appendChild(T) } this.e = this.i.contentWindow.document, this.e.open(); var z = "<html><head>", H = n.bodyid ? ' id="' + n.bodyid + '"' : ""; if (n.cssfile && (z += '<link rel="stylesheet" href="' + n.cssfile + '" />'), n.css && (z += '<style type="text/css">' + n.css + "</style>"), z += "</head><body" + H + ' contenteditable="true">' + (n.content || this.t.value), z += "</body></html>", this.e.write(z), this.e.close(), this.e.designMode = "On", this.d = 1, this.xhtml) try { this.e.execCommand("styleWithCSS", 0, 0) } catch (L) { try { this.e.execCommand("useCSS", 0, 1) } catch (L) { } } } var t = [], i = -30; return t.bold = [4, "Bold", "a", "bold"], t.italic = [5, "Italic", "a", "italic"], t.underline = [6, "Underline", "a", "underline"], t.strikethrough = [7, "Strikethrough", "a", "strikethrough"], t.subscript = [8, "Subscript", "a", "subscript"], t.superscript = [9, "Superscript", "a", "superscript"], t.orderedlist = [10, "Insert Ordered List", "a", "insertorderedlist"], t.unorderedlist = [11, "Insert Unordered List", "a", "insertunorderedlist"], t.outdent = [12, "Outdent", "a", "outdent"], t.indent = [13, "Indent", "a", "indent"], t.leftalign = [14, "Left Align", "a", "justifyleft"], t.centeralign = [15, "Center Align", "a", "justifycenter"], t.rightalign = [16, "Right Align", "a", "justifyright"], t.blockjustify = [17, "Block Justify", "a", "justifyfull"], t.undo = [18, "Undo", "a", "undo"], t.redo = [19, "Redo", "a", "redo"], t.image = [20, "Insert Image", "i", "insertimage", "Enter Image URL:", "http://"], t.hr = [21, "Insert Horizontal Rule", "a", "inserthorizontalrule"], t.link = [22, "Insert Hyperlink", "i", "createlink", "Enter URL:", "http://"], t.unlink = [23, "Remove Hyperlink", "a", "unlink"], t.unformat = [24, "Remove Formatting", "a", "removeformat"], t.print = [25, "Print", "a", "print"], e.prototype.print = function () { this.i.contentWindow.print() }, e.prototype.hover = function (e, t, i) { this.getSelection(), e.style.backgroundPosition = (i ? "34px " : "0px ") + t + "px" }, e.prototype.getSelection = function () { this.ie && this.e.getSelection && (this.sel = this.e.getSelection(), this.sel.getRangeAt && this.sel.rangeCount && (this.range = this.sel.getRangeAt(0))) }, e.prototype.restoreSelection = function () { this.range && this.ie && this.e.getSelection && (this.sel = this.e.getSelection(), this.sel.removeAllRanges(), this.sel.addRange(this.range)) }, e.prototype.ddaction = function (e, t) { var i = e.selectedIndex, n = e.options[i].value; this.action(t, n) }, e.prototype.action = function (e, t, i) { i && !this.ie ? alert("Your browser does not support this function.") : (this.restoreSelection(), this.e.execCommand(e, 0, t || null)) }, e.prototype.insert = function (e, t, i) { var n = prompt(e, t); null != n && "" != n && this.e.execCommand(i, 0, n) }, e.prototype.setfont = function () { this.restoreSelection(), execCommand("formatblock", 0, hType) }, e.prototype.resize = function (e) { this.mv && this.freeze(), this.i.bcs = TINY.cursor.top(e), this.mv = new Function("event", this.n + ".move(event)"), this.sr = new Function(this.n + ".freeze()"), this.ie ? (document.attachEvent("onmousemove", this.mv), document.attachEvent("onmouseup", this.sr)) : (document.addEventListener("mousemove", this.mv, 1), document.addEventListener("mouseup", this.sr, 1)) }, e.prototype.move = function (e) { var t = TINY.cursor.top(e); this.i.height = parseInt(this.i.height) + t - this.i.bcs, this.i.bcs = t }, e.prototype.freeze = function () { this.ie ? (document.detachEvent("onmousemove", this.mv), document.detachEvent("onmouseup", this.sr)) : (document.removeEventListener("mousemove", this.mv, 1), document.removeEventListener("mouseup", this.sr, 1)) }, e.prototype.toggle = function (e, t) { if (this.d) { var i = this.e.body.innerHTML; this.xhtml && (i = i.replace(/<span class="apple-style-span">(.*)<\/span>/gi, "$1"), i = i.replace(/ class="apple-style-span"/gi, ""), i = i.replace(/<span style="">/gi, ""), i = i.replace(/<br>/gi, "<br />"), i = i.replace(/<br ?\/?>$/gi, ""), i = i.replace(/^<br ?\/?>/gi, ""), i = i.replace(/(<img [^>]+[^\/])>/gi, "$1 />"), i = i.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi, "<strong>$1</strong>"), i = i.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi, "<em>$1</em>"), i = i.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi, '<span style="text-decoration:underline">$1</span>'), i = i.replace(/<(b|strong|em|i|u) style="font-weight:normal;?">(.*)<\/(b|strong|em|i|u)>/gi, "$2"), i = i.replace(/<(b|strong|em|i|u) style="(.*)">(.*)<\/(b|strong|em|i|u)>/gi, '<span style="$2"><$4>$3</$4></span>'), i = i.replace(/<span style="font-weight:normal;?">(.*)<\/span>/gi, "$1"), i = i.replace(/<span style="font-weight:bold;?">(.*)<\/span>/gi, "<strong>$1</strong>"), i = i.replace(/<span style="font-style:italic;?">(.*)<\/span>/gi, "<em>$1</em>"), i = i.replace(/<span style="font-weight:bold;?">(.*)<\/span>|<b\b[^>]*>(.*?)<\/b[^>]*>/gi, "<strong>$1</strong>")), t && (t.innerHTML = this.obj.toggletext || "display"), this.t.value = i, e || (this.t.style.height = this.i.height + "px", this.i.style.display = "none", this.t.style.display = "block", this.d = 0) } else { var i = this.t.value; t && (t.innerHTML = this.obj.toggletext || "source"), this.xhtml && !this.ie && (i = i.replace(/<strong>(.*)<\/strong>/gi, '<span style="font-weight:bold;">$1</span>'), i = i.replace(/<em>(.*)<\/em>/gi, '<span style="font-weight:italic;">$1</span>')), this.e.body.innerHTML = i, this.t.style.display = "none", this.i.style.display = "block", this.d = 1 } }, e.prototype.post = function () { this.d && this.toggle(1) }, { edit: e } }(), TINY.cursor = function () { return { top: function (e) { return T$$$() ? window.event.clientY + document.documentElement.scrollTop + document.body.scrollTop : e.clientY + window.scrollY } } }();